<view class="page">
  <!-- <view class="custom-navbar">
    <text class="custom-navbar-title">图表</text>
    <text class="custom-navbar-subtitle">收支趋势与排行榜</text>
  </view> -->

  <!-- 收入 / 支出 切换 -->
  <view class="type-switch">
    <view class="type-pill">
      <view class="type-pill-inner">
        <view class="type-pill-item {{type === 'expense' ? 'active' : ''}}" bindtap="onTypeChange" data-type="expense">支出</view>
        <view class="type-pill-item {{type === 'income' ? 'active' : ''}}" bindtap="onTypeChange" data-type="income">收入</view>
      </view>
    </view>
    <text class="type-summary">
      {{type === 'expense' ? '总支出' : '总收入'}}
      <text class="type-summary-amount">{{type === 'expense' ? '-' : '+'}} {{summaryAmount}}</text>
    </text>
  </view>

  <!-- 周 / 月 / 年 tabs -->
  <view class="tabs-wrapper">
    <t-tabs value="{{period}}" bind:change="onPeriodChange">
      <t-tab-panel value="week" label="周"></t-tab-panel>
      <t-tab-panel value="month" label="月"></t-tab-panel>
      <t-tab-panel value="year" label="年"></t-tab-panel>
    </t-tabs>
  </view>

  <scroll-view class="content" scroll-y>
    <!-- 最近 5 月 + 汇总 + 伪折线图（按月） -->
    <view class="month-selector">
      <view class="month-tags">
        <text wx:for="{{monthTags}}" wx:key="index" class="month-tag {{item.active ? 'active' : ''}}" bindtap="onMonthTagTap" data-index="{{index}}">{{item.label}}</text>
      </view>
      <text class="unit-text">单位：元</text>
    </view>

    <view class="summary-row">
      <text class="summary-label">
        {{type === 'expense' ? '总支出' : '总收入'}}
        <text class="summary-amount {{type === 'expense' ? 'negative-text' : 'positive-text'}}">{{type === 'expense' ? '-' : '+'}} {{summaryAmount}}</text>
      </text>
      <text class="summary-label">
        日均
        <text class="summary-amount">{{dailyAverage}}</text>
      </text>
    </view>

    <!-- 简单柱形图模拟折线趋势 -->
    <view class="chart-card">
      <view class="chart-bars">
        <view class="chart-bar-item" wx:for="{{chartData}}" wx:key="label">
          <view class="chart-bar" style="height: {{item.percentage}}%"></view>
          <text class="chart-label">{{item.label}}</text>
        </view>
      </view>
      <view class="chart-footer">
        <text class="chart-desc">{{period === 'month' ? '本月' : period === 'week' ? '本周' : '今年'}}{{type === 'expense' ? '支出' : '收入'}}趋势</text>
      </view>
    </view>

    <!-- 排行榜 -->
    <view class="rank-section">
      <view class="rank-header">
        <text class="rank-title">{{type === 'expense' ? '支出' : '收入'}}排行榜</text>
        <text class="rank-subtitle">按金额排序</text>
      </view>

      <view class="rank-list">
        <view class="rank-item-wrapper" wx:for="{{rankingData}}" wx:key="categoryName">
          <view class="rank-item">
            <view class="rank-left">
              <view class="rank-badge {{index === 0 ? 'first' : ''}}">{{index + 1}}</view>
              <view class="rank-info">
                <text class="rank-name">{{item.categoryIcon}} {{item.categoryName}}</text>
                <text class="rank-desc">共 {{item.count}} 笔 · 占比 {{item.percentage}}%</text>
              </view>
            </view>
            <view class="rank-right">
              <text class="rank-amount {{type === 'expense' ? 'negative-text' : 'positive-text'}}">{{type === 'expense' ? '-' : '+'}} {{item.amount}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </scroll-view>
</view>