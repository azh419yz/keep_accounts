<view class="page">
  <!-- 顶部导航 -->
  <t-navbar title="记好帐" fixed="{{false}}" leftArrow="{{false}}">
  </t-navbar>

  <!-- 顶部月份 + 收支统计 -->
  <view class="header-section">
    <view class="month-and-summary">
      <!-- 月份选择 -->
      <picker
        mode="date"
        value="{{pickerDate}}"
        fields="month"
        start="2020-01"
        end="{{maxDate}}"
        bindchange="onMonthPickerChange"
        class="month-wrapper"
      >
        <view class="month-main">
          <text class="month-text">{{currentMonthText}}</text>
          <text class="month-arrow">▼</text>
        </view>
        <text class="month-sub">点击选择月份</text>
      </picker>

      <!-- 收支统计 -->
      <view class="summary-wrapper">
        <view class="summary-card expense">
          <view class="summary-label-row">
            <text class="summary-label">本月支出</text>
            <text class="summary-tag negative">{{expenseChange}}</text>
          </view>
          <text class="summary-amount negative-text">- {{monthExpense}}</text>
        </view>
        <view class="summary-card income">
          <view class="summary-label-row">
            <text class="summary-label">本月收入</text>
            <text class="summary-tag positive">{{incomeChange}}</text>
          </view>
          <text class="summary-amount positive-text">+ {{monthIncome}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 明细列表 -->
  <scroll-view class="content" scroll-y>
    <view wx:for="{{billGroups}}" wx:key="date" class="section">
      <view class="section-header">
        <view class="section-date">
          <text class="section-date-main">{{item.dateText}}</text>
          <text class="section-date-sub">{{item.weekday}}</text>
        </view>
        <text class="section-total">
          当日{{item.type === 'expense' ? '支出' : '收入'}}
          <text class="section-total-amount {{item.type === 'expense' ? 'negative-text' : 'positive-text'}}">
            {{item.type === 'expense' ? '-' : '+'}} {{item.dayTotal}}
          </text>
        </text>
      </view>

      <t-cell-group>
        <t-swipe-cell
          wx:for="{{item.bills}}"
          wx:for-item="bill"
          wx:key="id"
          wx:for-index="billIndex"
          left="{{[]}}"
          right="{{deleteBtnConfig}}"
          bind:click="onSwipeCellClick"
          data-bill-id="{{bill.id}}"
          data-date="{{item.date}}"
          class="swipe-cell-wrapper"
        >
          <t-cell hover="{{false}}">
            <view class="bill-item">
              <view class="bill-left">
                <view class="bill-icon bill-icon-{{bill.categoryClass}}">{{bill.icon}}</view>
                <view class="bill-info">
                  <text class="bill-title">{{bill.title}}</text>
                  <text class="bill-subtitle">{{bill.category}} · {{bill.remark}}</text>
                </view>
              </view>
              <view class="bill-right">
                <text class="bill-amount {{bill.type === 'expense' ? 'negative-text' : 'positive-text'}}">
                  {{bill.type === 'expense' ? '-' : '+'}} {{bill.amount}}
                </text>
                <text class="bill-time">{{bill.time}}</text>
              </view>
            </view>
          </t-cell>
        </t-swipe-cell>
      </t-cell-group>
    </view>

    <view class="load-more-hint">
      上滑加载更多 · 自动切换至上个月
    </view>
  </scroll-view>
</view>
